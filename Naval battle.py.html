<html>
<head>
<title>Naval battle.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
Naval battle.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">random </span><span class="s0">import </span><span class="s1">randint</span>


<span class="s0">class </span><span class="s1">Dot:</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y):</span>
        <span class="s1">self.x = x</span>
        <span class="s1">self.y = y</span>

    <span class="s0">def </span><span class="s1">__eq__(self</span><span class="s0">, </span><span class="s1">other):</span>
        <span class="s0">return </span><span class="s1">self.x == other.x </span><span class="s0">and </span><span class="s1">self.y == other.y</span>

    <span class="s0">def </span><span class="s1">__repr__(self):</span>
        <span class="s0">return </span><span class="s2">f&quot;(</span><span class="s0">{</span><span class="s1">self.x</span><span class="s0">}</span><span class="s2">, </span><span class="s0">{</span><span class="s1">self.y</span><span class="s0">}</span><span class="s2">)&quot;</span>


<span class="s0">class </span><span class="s1">BoardException(Exception):</span>
    <span class="s0">pass</span>


<span class="s0">class </span><span class="s1">BoardOutException(BoardException):</span>
    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s0">return </span><span class="s2">&quot;Вы стреляете за границы!&quot;</span>


<span class="s0">class </span><span class="s1">BoardUsedException(BoardException):</span>
    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s0">return </span><span class="s2">&quot;Вы уже стреляли в эту точку!&quot;</span>


<span class="s0">class </span><span class="s1">BoardWrongShipException(BoardException):</span>
    <span class="s0">pass</span>


<span class="s0">class </span><span class="s1">Ship:</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">bow</span><span class="s0">, </span><span class="s1">l</span><span class="s0">, </span><span class="s1">o):</span>
        <span class="s1">self.bow = bow</span>
        <span class="s1">self.l = l</span>
        <span class="s1">self.o = o</span>
        <span class="s1">self.lives = l</span>

    <span class="s1">@property</span>
    <span class="s0">def </span><span class="s1">dots(self):</span>
        <span class="s1">ship_dots = []</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(self.l):</span>
            <span class="s1">cur_x = self.bow.x</span>
            <span class="s1">cur_y = self.bow.y</span>

            <span class="s0">if </span><span class="s1">self.o == </span><span class="s3">0</span><span class="s1">:</span>
                <span class="s1">cur_x += i</span>

            <span class="s0">elif </span><span class="s1">self.o == </span><span class="s3">1</span><span class="s1">:</span>
                <span class="s1">cur_y += i</span>

            <span class="s1">ship_dots.append(Dot(cur_x</span><span class="s0">, </span><span class="s1">cur_y))</span>

        <span class="s0">return </span><span class="s1">ship_dots</span>

    <span class="s0">def </span><span class="s1">shooten(self</span><span class="s0">, </span><span class="s1">shot):</span>
        <span class="s0">return </span><span class="s1">shot </span><span class="s0">in </span><span class="s1">self.dots</span>


<span class="s0">class </span><span class="s1">Board:</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">hid=</span><span class="s0">False, </span><span class="s1">size=</span><span class="s3">6</span><span class="s1">):</span>
        <span class="s1">self.size = size</span>
        <span class="s1">self.hid = hid</span>

        <span class="s1">self.count = </span><span class="s3">0</span>

        <span class="s1">self.field = [[</span><span class="s2">&quot;O&quot;</span><span class="s1">] * size </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(size)]</span>

        <span class="s1">self.busy = []</span>
        <span class="s1">self.ships = []</span>

    <span class="s0">def </span><span class="s1">add_ship(self</span><span class="s0">, </span><span class="s1">ship):</span>

        <span class="s0">for </span><span class="s1">d </span><span class="s0">in </span><span class="s1">ship.dots:</span>
            <span class="s0">if </span><span class="s1">self.out(d) </span><span class="s0">or </span><span class="s1">d </span><span class="s0">in </span><span class="s1">self.busy:</span>
                <span class="s0">raise </span><span class="s1">BoardWrongShipException()</span>
        <span class="s0">for </span><span class="s1">d </span><span class="s0">in </span><span class="s1">ship.dots:</span>
            <span class="s1">self.field[d.x][d.y] = </span><span class="s2">&quot;■&quot;</span>
            <span class="s1">self.busy.append(d)</span>

        <span class="s1">self.ships.append(ship)</span>
        <span class="s1">self.contour(ship)</span>

    <span class="s0">def </span><span class="s1">contour(self</span><span class="s0">, </span><span class="s1">ship</span><span class="s0">, </span><span class="s1">verb=</span><span class="s0">False</span><span class="s1">):</span>
        <span class="s1">near = [</span>
            <span class="s1">(-</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">]</span>
        <span class="s0">for </span><span class="s1">d </span><span class="s0">in </span><span class="s1">ship.dots:</span>
            <span class="s0">for </span><span class="s1">dx</span><span class="s0">, </span><span class="s1">dy </span><span class="s0">in </span><span class="s1">near:</span>
                <span class="s1">cur = Dot(d.x + dx</span><span class="s0">, </span><span class="s1">d.y + dy)</span>
                <span class="s0">if not </span><span class="s1">(self.out(cur)) </span><span class="s0">and </span><span class="s1">cur </span><span class="s0">not in </span><span class="s1">self.busy:</span>
                    <span class="s0">if </span><span class="s1">verb:</span>
                        <span class="s1">self.field[cur.x][cur.y] = </span><span class="s2">&quot;.&quot;</span>
                    <span class="s1">self.busy.append(cur)</span>

    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s1">res = </span><span class="s2">&quot;&quot;</span>
        <span class="s1">res += </span><span class="s2">&quot;  | 1 | 2 | 3 | 4 | 5 | 6 |&quot;</span>
        <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">row </span><span class="s0">in </span><span class="s1">enumerate(self.field):</span>
            <span class="s1">res += </span><span class="s2">f&quot;</span><span class="s0">\n{</span><span class="s1">i + </span><span class="s3">1</span><span class="s0">} </span><span class="s2">| &quot; </span><span class="s1">+ </span><span class="s2">&quot; | &quot;</span><span class="s1">.join(row) + </span><span class="s2">&quot; |&quot;</span>

        <span class="s0">if </span><span class="s1">self.hid:</span>
            <span class="s1">res = res.replace(</span><span class="s2">&quot;■&quot;</span><span class="s0">, </span><span class="s2">&quot;O&quot;</span><span class="s1">)</span>
        <span class="s0">return </span><span class="s1">res</span>

    <span class="s0">def </span><span class="s1">out(self</span><span class="s0">, </span><span class="s1">d):</span>
        <span class="s0">return not </span><span class="s1">((</span><span class="s3">0 </span><span class="s1">&lt;= d.x &lt; self.size) </span><span class="s0">and </span><span class="s1">(</span><span class="s3">0 </span><span class="s1">&lt;= d.y &lt; self.size))</span>

    <span class="s0">def </span><span class="s1">shot(self</span><span class="s0">, </span><span class="s1">d):</span>
        <span class="s0">if </span><span class="s1">self.out(d):</span>
            <span class="s0">raise </span><span class="s1">BoardOutException()</span>

        <span class="s0">if </span><span class="s1">d </span><span class="s0">in </span><span class="s1">self.busy:</span>
            <span class="s0">raise </span><span class="s1">BoardUsedException()</span>

        <span class="s1">self.busy.append(d)</span>

        <span class="s0">for </span><span class="s1">ship </span><span class="s0">in </span><span class="s1">self.ships:</span>
            <span class="s0">if </span><span class="s1">d </span><span class="s0">in </span><span class="s1">ship.dots:</span>
                <span class="s1">ship.lives -= </span><span class="s3">1</span>
                <span class="s1">self.field[d.x][d.y] = </span><span class="s2">&quot;X&quot;</span>
                <span class="s0">if </span><span class="s1">ship.lives == </span><span class="s3">0</span><span class="s1">:</span>
                    <span class="s1">self.count += </span><span class="s3">1</span>
                    <span class="s1">self.contour(ship</span><span class="s0">, </span><span class="s1">verb=</span><span class="s0">True</span><span class="s1">)</span>
                    <span class="s1">print(</span><span class="s2">&quot;Корабль уничтожен!&quot;</span><span class="s1">)</span>
                    <span class="s0">return False</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">print(</span><span class="s2">&quot;Есть пробитие!&quot;</span><span class="s1">)</span>
                    <span class="s0">return True</span>

        <span class="s1">self.field[d.x][d.y] = </span><span class="s2">&quot;.&quot;</span>
        <span class="s1">print(</span><span class="s2">&quot;Не попал!&quot;</span><span class="s1">)</span>
        <span class="s0">return False</span>

    <span class="s0">def </span><span class="s1">begin(self):</span>
        <span class="s1">self.busy = []</span>


<span class="s0">class </span><span class="s1">Player:</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">board</span><span class="s0">, </span><span class="s1">enemy):</span>
        <span class="s1">self.board = board</span>
        <span class="s1">self.enemy = enemy</span>

    <span class="s0">def </span><span class="s1">ask(self):</span>
        <span class="s0">raise </span><span class="s1">NotImplementedError()</span>

    <span class="s0">def </span><span class="s1">move(self):</span>
        <span class="s0">while True</span><span class="s1">:</span>
            <span class="s0">try</span><span class="s1">:</span>
                <span class="s1">target = self.ask()</span>
                <span class="s1">repeat = self.enemy.shot(target)</span>
                <span class="s0">return </span><span class="s1">repeat</span>
            <span class="s0">except </span><span class="s1">BoardException </span><span class="s0">as </span><span class="s1">e:</span>
                <span class="s1">print(e)</span>


<span class="s0">class </span><span class="s1">AI(Player):</span>
    <span class="s0">def </span><span class="s1">ask(self):</span>
        <span class="s1">d = Dot(randint(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">randint(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">5</span><span class="s1">))</span>
        <span class="s1">print(</span><span class="s2">f&quot;Ход компьютера: </span><span class="s0">{</span><span class="s1">d.x + </span><span class="s3">1</span><span class="s0">} {</span><span class="s1">d.y + </span><span class="s3">1</span><span class="s0">}</span><span class="s2">&quot;</span><span class="s1">)</span>
        <span class="s0">return </span><span class="s1">d</span>


<span class="s0">class </span><span class="s1">User(Player):</span>
    <span class="s0">def </span><span class="s1">ask(self):</span>
        <span class="s0">while True</span><span class="s1">:</span>
            <span class="s1">cords = input(</span><span class="s2">&quot;Ваш ход: &quot;</span><span class="s1">).split()</span>

            <span class="s0">if </span><span class="s1">len(cords) != </span><span class="s3">2</span><span class="s1">:</span>
                <span class="s1">print(</span><span class="s2">&quot; Введите 2 координаты! &quot;</span><span class="s1">)</span>
                <span class="s0">continue</span>

            <span class="s1">x</span><span class="s0">, </span><span class="s1">y = cords</span>

            <span class="s0">if not </span><span class="s1">(x.isdigit()) </span><span class="s0">or not </span><span class="s1">(y.isdigit()):</span>
                <span class="s1">print(</span><span class="s2">&quot; Введите числа! &quot;</span><span class="s1">)</span>
                <span class="s0">continue</span>

            <span class="s1">x</span><span class="s0">, </span><span class="s1">y = int(x)</span><span class="s0">, </span><span class="s1">int(y)</span>

            <span class="s0">return </span><span class="s1">Dot(x - </span><span class="s3">1</span><span class="s0">, </span><span class="s1">y - </span><span class="s3">1</span><span class="s1">)</span>


<span class="s0">class </span><span class="s1">Game:</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">size=</span><span class="s3">6</span><span class="s1">):</span>
        <span class="s1">self.size = size</span>
        <span class="s1">pl = self.random_board()</span>
        <span class="s1">co = self.random_board()</span>
        <span class="s1">co.hid = </span><span class="s0">True</span>

        <span class="s1">self.ai = AI(co</span><span class="s0">, </span><span class="s1">pl)</span>
        <span class="s1">self.us = User(pl</span><span class="s0">, </span><span class="s1">co)</span>

    <span class="s0">def </span><span class="s1">random_board(self):</span>
        <span class="s1">board = </span><span class="s0">None</span>
        <span class="s0">while </span><span class="s1">board </span><span class="s0">is None</span><span class="s1">:</span>
            <span class="s1">board = self.random_place()</span>
        <span class="s0">return </span><span class="s1">board</span>

    <span class="s0">def </span><span class="s1">random_place(self):</span>
        <span class="s1">lens = [</span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>
        <span class="s1">board = Board(size=self.size)</span>
        <span class="s1">attempts = </span><span class="s3">0</span>
        <span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">lens:</span>
            <span class="s0">while True</span><span class="s1">:</span>
                <span class="s1">attempts += </span><span class="s3">1</span>
                <span class="s0">if </span><span class="s1">attempts &gt; </span><span class="s3">2000</span><span class="s1">:</span>
                    <span class="s0">return None</span>
                <span class="s1">ship = Ship(Dot(randint(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">self.size)</span><span class="s0">, </span><span class="s1">randint(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">self.size))</span><span class="s0">, </span><span class="s1">l</span><span class="s0">, </span><span class="s1">randint(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>
                <span class="s0">try</span><span class="s1">:</span>
                    <span class="s1">board.add_ship(ship)</span>
                    <span class="s0">break</span>
                <span class="s0">except </span><span class="s1">BoardWrongShipException:</span>
                    <span class="s0">pass</span>
        <span class="s1">board.begin()</span>
        <span class="s0">return </span><span class="s1">board</span>

    <span class="s0">def </span><span class="s1">greet(self):</span>
        <span class="s1">print(</span><span class="s2">&quot;-------------------&quot;</span><span class="s1">)</span>
        <span class="s1">print(</span><span class="s2">&quot;  Приветсвуем вас  &quot;</span><span class="s1">)</span>
        <span class="s1">print(</span><span class="s2">&quot;      в игре       &quot;</span><span class="s1">)</span>
        <span class="s1">print(</span><span class="s2">&quot;    морской бой    &quot;</span><span class="s1">)</span>
        <span class="s1">print(</span><span class="s2">&quot;-------------------&quot;</span><span class="s1">)</span>
        <span class="s1">print(</span><span class="s2">&quot; формат ввода: x y &quot;</span><span class="s1">)</span>
        <span class="s1">print(</span><span class="s2">&quot; x - номер строки  &quot;</span><span class="s1">)</span>
        <span class="s1">print(</span><span class="s2">&quot; y - номер столбца &quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">loop(self):</span>
        <span class="s1">num = </span><span class="s3">0</span>
        <span class="s0">while True</span><span class="s1">:</span>
            <span class="s1">print(</span><span class="s2">&quot;-&quot; </span><span class="s1">* </span><span class="s3">20</span><span class="s1">)</span>
            <span class="s1">print(</span><span class="s2">&quot;Доска пользователя:&quot;</span><span class="s1">)</span>
            <span class="s1">print(self.us.board)</span>
            <span class="s1">print(</span><span class="s2">&quot;-&quot; </span><span class="s1">* </span><span class="s3">20</span><span class="s1">)</span>
            <span class="s1">print(</span><span class="s2">&quot;Доска компьютера:&quot;</span><span class="s1">)</span>
            <span class="s1">print(self.ai.board)</span>
            <span class="s0">if </span><span class="s1">num % </span><span class="s3">2 </span><span class="s1">== </span><span class="s3">0</span><span class="s1">:</span>
                <span class="s1">print(</span><span class="s2">&quot;-&quot; </span><span class="s1">* </span><span class="s3">20</span><span class="s1">)</span>
                <span class="s1">print(</span><span class="s2">&quot;Ходит пользователь!&quot;</span><span class="s1">)</span>
                <span class="s1">repeat = self.us.move()</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">print(</span><span class="s2">&quot;-&quot; </span><span class="s1">* </span><span class="s3">20</span><span class="s1">)</span>
                <span class="s1">print(</span><span class="s2">&quot;Ходит компьютер!&quot;</span><span class="s1">)</span>
                <span class="s1">repeat = self.ai.move()</span>
            <span class="s0">if </span><span class="s1">repeat:</span>
                <span class="s1">num -= </span><span class="s3">1</span>

            <span class="s0">if </span><span class="s1">self.ai.board.count == </span><span class="s3">7</span><span class="s1">:</span>
                <span class="s1">print(</span><span class="s2">&quot;-&quot; </span><span class="s1">* </span><span class="s3">20</span><span class="s1">)</span>
                <span class="s1">print(</span><span class="s2">&quot;Пользователь выиграл!&quot;</span><span class="s1">)</span>
                <span class="s0">break</span>

            <span class="s0">if </span><span class="s1">self.us.board.count == </span><span class="s3">7</span><span class="s1">:</span>
                <span class="s1">print(</span><span class="s2">&quot;-&quot; </span><span class="s1">* </span><span class="s3">20</span><span class="s1">)</span>
                <span class="s1">print(</span><span class="s2">&quot;Компьютер выиграл!&quot;</span><span class="s1">)</span>
                <span class="s0">break</span>
            <span class="s1">num += </span><span class="s3">1</span>

    <span class="s0">def </span><span class="s1">start(self):</span>
        <span class="s1">self.greet()</span>
        <span class="s1">self.loop()</span>


<span class="s1">g = Game()</span>
<span class="s1">g.start()</span></pre>
</body>
</html>